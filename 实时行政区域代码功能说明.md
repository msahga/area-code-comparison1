# 实时行政区域代码功能说明

## 功能概述

本次更新为区域代码对比程序增加了实时行政区域代码功能，通过高德地图API获取最新的行政区域代码，并在Excel输出文件的G列显示。

## 新增功能

### 1. 实时行政区域代码获取
- 通过高德地图API获取最新的行政区域代码
- 支持根据区域名称和区域代码两种方式查询
- 自动处理API请求失败的情况

### 2. Excel输出增强
- 在G列新增"实时行政区域代码"列
- 使用蓝色背景突出显示实时数据
- 保持原有的匹配状态颜色标识

## 配置说明

### 高德地图API配置
在 `src/main/resources/application.properties` 文件中配置：

```properties
# 高德地图API配置
amap.api.key=your_amap_api_key_here
```

**重要：** 请将 `your_amap_api_key_here` 替换为您实际的高德地图API密钥。

### 获取高德地图API密钥
1. 访问高德开放平台：https://lbs.amap.com/
2. 注册并登录账号
3. 创建应用并获取API密钥
4. 将密钥配置到配置文件中

## 代码变更

### 1. 新增文件
- `src/main/java/com/example/service/RealTimeAreaCodeService.java` - 实时行政区域代码服务

### 2. 修改文件
- `src/main/java/com/example/entity/ComparisonResult.java` - 增加实时区域代码字段
- `src/main/java/com/example/service/ComparisonService.java` - 集成实时区域代码服务
- `src/main/java/com/example/service/ExcelOutputService.java` - 增加G列显示
- `src/main/resources/application.properties` - 增加API配置
- `pom.xml` - 增加Jackson依赖

## 输出格式

生成的Excel文件现在包含以下列：
- A列：数据库区域代码
- B列：数据库区域名称
- C列：Excel区域代码
- D列：Excel区域名称
- E列：匹配状态
- F列：备注
- **G列：实时行政区域代码** (新增)

## 使用说明

1. 确保已配置正确的高德地图API密钥
2. 运行程序：`mvn exec:java`
3. 程序会自动调用高德API获取实时行政区域代码
4. 结果保存在Excel文件的G列中

## 注意事项

1. **API限制**：高德地图API有调用频率限制，程序已添加100ms延迟避免超限
2. **网络依赖**：需要网络连接才能获取实时数据
3. **API密钥安全**：请妥善保管API密钥，不要提交到版本控制系统
4. **错误处理**：如果API调用失败，G列会显示"获取失败"或"未找到"

## 技术实现

### API调用流程
1. 优先通过区域名称查询
2. 如果未找到，则通过区域代码查询
3. 解析JSON响应获取adcode字段
4. 处理各种异常情况

### 性能优化
- 添加请求超时设置（连接5秒，读取10秒）
- 批量处理时添加延迟避免API限制
- 完善的错误处理和日志记录

## 版本历史

- v1.1.0: 新增实时行政区域代码功能
  - 集成高德地图API
  - 增加G列显示实时数据
  - 完善错误处理和日志记录 